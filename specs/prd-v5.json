[
  {
    "category": "backend",
    "description": "Create base leaderboard endpoint with pagination and type filtering",
    "steps": [
      "Create models/leaderboard.go with LeaderboardEntry struct (rank, id, type, display_name, avatar_url, reputation, problems_solved, answers_accepted)",
      "Create db/leaderboard.go with LeaderboardRepository and GetLeaderboard(ctx, opts) method",
      "Query: UNION agents (with bonus + calculated reputation) and users (calculated reputation)",
      "ORDER BY reputation DESC, created_at ASC for tie-breaking",
      "Add ROW_NUMBER() OVER (ORDER BY reputation DESC) as rank",
      "Support type filter: all (default), agents, users",
      "Support pagination: limit (default 50, max 100), offset (default 0)",
      "Return LeaderboardEntry[] with rank, total_count",
      "Create handlers/leaderboard.go with LeaderboardHandler struct and GetLeaderboard method",
      "Parse query params: type (all/agents/users), limit, offset",
      "Response: { data: LeaderboardEntry[], meta: { total, page, per_page, has_more } }",
      "Add route: r.Get('/leaderboard', leaderboardHandler.GetLeaderboard) in router.go",
      "Create handlers/leaderboard_test.go with 5 tests (TDD approach)",
      "Test: TestGetLeaderboard_AllTypes - returns mixed agents and users in reputation order",
      "Test: TestGetLeaderboard_AgentsOnly - type=agents filters to agents only",
      "Test: TestGetLeaderboard_UsersOnly - type=users filters to users only",
      "Test: TestGetLeaderboard_Pagination - limit and offset work correctly",
      "Test: TestGetLeaderboard_RankingOrder - rank numbers are correct (1, 2, 3...)",
      "Verify: go test ./internal/api/handlers/leaderboard_test.go passes",
      "Verify: GET /v1/leaderboard returns ranked list"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Add timeframe filtering to leaderboard (all_time, monthly, weekly)",
    "steps": [
      "Add timeframe field to LeaderboardOptions struct in models/leaderboard.go",
      "Add getMonthStart() helper: returns first day of current month 00:00:00",
      "Add getWeekStart() helper: returns Monday of current week 00:00:00",
      "Update GetLeaderboard() to accept timeframe: all_time (default), monthly, weekly",
      "For monthly/weekly: add WHERE created_at >= start_date to all activity queries",
      "Filter problems solved, answers accepted, upvotes/downvotes by date range",
      "Keep agents.reputation (bonus points) - not time-limited",
      "Calculate reputation only from activity within timeframe",
      "Update handlers/leaderboard.go to parse timeframe query param",
      "Add tests to leaderboard_test.go:",
      "Test: TestGetLeaderboard_AllTime - returns total reputation (no date filter)",
      "Test: TestGetLeaderboard_Monthly - only counts activity from current month",
      "Test: TestGetLeaderboard_Weekly - only counts activity from current week (Mon-Sun)",
      "Test: TestGetLeaderboard_InvalidTimeframe - defaults to all_time for invalid values",
      "Verify: GET /v1/leaderboard?timeframe=monthly returns monthly rankings",
      "Verify: GET /v1/leaderboard?timeframe=weekly returns weekly rankings"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Create tag-specific leaderboard endpoint",
    "steps": [
      "Create db/leaderboard_tags.go with GetLeaderboardByTag(ctx, tag, opts) method",
      "Query: JOIN posts on problems/questions/ideas to filter by tag",
      "Only count activity (approaches, answers, responses) on posts with the specified tag",
      "Calculate reputation from tag-specific activity only",
      "Return same LeaderboardEntry structure as GetLeaderboard",
      "Add GetLeaderboardByTag handler to handlers/leaderboard.go",
      "Parse tag from path parameter: {tag}",
      "Support same type and pagination params as base leaderboard",
      "Add route: r.Get('/leaderboard/tags/{tag}', leaderboardHandler.GetLeaderboardByTag) in router.go",
      "Create handlers/leaderboard_tags_test.go with 4 tests (TDD approach)",
      "Test: TestGetLeaderboardByTag_ValidTag - returns rankings for active tag",
      "Test: TestGetLeaderboardByTag_NoActivity - returns empty array for tag with no activity",
      "Test: TestGetLeaderboardByTag_Pagination - limit/offset work for tag leaderboards",
      "Test: TestGetLeaderboardByTag_InvalidTag - handles non-existent tags gracefully",
      "Verify: GET /v1/leaderboard/tags/golang returns golang-specific rankings"
    ],
    "passes": true
  },
  {
    "category": "frontend",
    "description": "Add TypeScript types and API client methods for leaderboard",
    "steps": [
      "Add LeaderboardEntry interface to api-types.ts:",
      "  - rank: number, id: string, type: 'agent'|'user', display_name: string, avatar_url?: string",
      "  - reputation: number, problems_solved: number, answers_accepted: number",
      "Add LeaderboardKeyStats interface: { problems_solved, answers_accepted, ideas_posted }",
      "Add APILeaderboardResponse: { data: LeaderboardEntry[], meta: { total, page, per_page, has_more } }",
      "Add FetchLeaderboardParams: { type?: 'all'|'agents'|'users', timeframe?: 'all_time'|'monthly'|'weekly', limit?: number, offset?: number }",
      "Add getLeaderboard(params?) method to SolvrAPI class in api.ts",
      "Method: GET /v1/leaderboard with query string from params",
      "Add getLeaderboardByTag(tag, params?) method to SolvrAPI class",
      "Method: GET /v1/leaderboard/tags/{tag} with query string from params",
      "Verify: npx tsc --noEmit passes with no type errors"
    ],
    "passes": true
  },
  {
    "category": "frontend",
    "description": "Create useLeaderboard hook for fetching and managing leaderboard state",
    "steps": [
      "Create hooks/use-leaderboard.ts following useProblems pattern",
      "Hook accepts: { type?: 'all'|'agents'|'users', timeframe?: 'all_time'|'monthly'|'weekly' }",
      "State: entries[], loading, error, total, offset, hasMore",
      "On mount or param change: call api.getLeaderboard({ type, timeframe, limit: 50, offset })",
      "Transform API LeaderboardEntry to UI-friendly format (add profile link, format reputation)",
      "loadMore() function: increments offset, fetches next page, appends to entries[]",
      "refetch() function: resets offset to 0, clears entries, fetches from start",
      "Returns: { entries, loading, error, total, hasMore, loadMore, refetch }",
      "Create hooks/use-leaderboard.test.ts with 6 tests (TDD approach)",
      "Test: fetches from API on mount with correct params",
      "Test: transforms LeaderboardEntry data correctly (adds profileLink based on type)",
      "Test: type filter change resets to page 1 and refetches",
      "Test: timeframe filter change resets to page 1 and refetches",
      "Test: loadMore() increments offset and appends results",
      "Test: error handling displays error state",
      "Verify: all 6 tests pass"
    ],
    "passes": true
  },
  {
    "category": "frontend",
    "description": "Create /leaderboard page with tabs, filters, and ranked list",
    "steps": [
      "Create app/leaderboard/page.tsx as 'use client' component",
      "Add useState for: timeframe ('all_time'|'monthly'|'weekly'), type ('all'|'agents'|'users')",
      "Import and use useLeaderboard({ type, timeframe }) hook",
      "Page layout: Header with title 'LEADERBOARD', description, and filter controls",
      "Timeframe tabs: ALL TIME | THIS MONTH | THIS WEEK (active tab highlighted)",
      "Type filter pills: ALL | HUMANS | AGENTS (active pill highlighted)",
      "Leaderboard list: for each entry show:",
      "  - Rank badge: #1-#10 in colored badge (gold #1, silver #2, bronze #3), rest plain number",
      "  - Avatar with fallback to display_name initials",
      "  - Display name as Link to /agents/{id} or /users/{id} based on type",
      "  - Type badge: Human icon for users, Bot icon for agents",
      "  - Reputation score with '+REP' label in emerald text",
      "  - Key stats: 'X problems solved • Y answers accepted' in muted text",
      "Loading state: skeleton loaders for 10 entries",
      "Empty state: 'No entries found' with message",
      "Error state: 'Failed to load leaderboard' with retry button",
      "LOAD MORE button at bottom: visible when hasMore, calls loadMore(), shows loading spinner",
      "Add page metadata: title='Leaderboard — Solvr', description='Top contributors on Solvr'",
      "Style: consistent with /agents and /users pages (monospace fonts, border styling)",
      "Create app/leaderboard/page.test.tsx with 8 tests (TDD approach)",
      "Test: renders timeframe tabs (all time, monthly, weekly)",
      "Test: clicking timeframe tab updates active state and refetches",
      "Test: renders type filter pills (all, humans, agents)",
      "Test: clicking type pill updates filter and refetches",
      "Test: renders leaderboard entries with correct rank badges",
      "Test: rank #1-#3 have special styling (gold/silver/bronze)",
      "Test: entries link to correct profile pages based on type",
      "Test: LOAD MORE button calls loadMore() and is hidden when !hasMore",
      "Verify: all 8 tests pass"
    ],
    "passes": true
  },
  {
    "category": "frontend",
    "description": "Add LEADERBOARD navigation link to header",
    "steps": [
      "Open frontend/components/header.tsx",
      "Add LEADERBOARD link to desktop nav between AGENTS and API (line ~115)",
      "Link href: /leaderboard",
      "Style: font-mono text-xs tracking-wider text-muted-foreground hover:text-foreground transition-colors",
      "Add LEADERBOARD link to mobile menu between AGENTS and API",
      "Update frontend/components/header.test.tsx",
      "Add test: 'displays LEADERBOARD link in desktop navigation'",
      "Add test: 'displays LEADERBOARD link in mobile menu'",
      "Verify: both tests pass",
      "Verify: link appears in correct position on both desktop and mobile"
    ],
    "passes": true
  },
  {
    "category": "backend",
    "description": "Add TDD tests for search accuracy - exact title matches and multi-word queries",
    "steps": [
      "Open backend/internal/api/handlers/search_integration_test.go",
      "Add TestSearch_ExactTitleMatch test function",
      "Create 4 test posts with titles: 'Race Conditions in Go', 'How to Handle Race Conditions', 'Understanding Race Conditions', 'Thread Safety and Race Conditions'",
      "Search for 'race condition' (without s) - should return all 4 posts using prefix matching",
      "Search for 'race conditions' (with s) - should return all 4 posts",
      "Search for exact title 'Race Conditions in Go' - should return that post as #1 result with highest rank",
      "Add TestSearch_MultiWordQuery test function",
      "Test AND vs OR logic: 'race condition' should use OR not AND",
      "Should find posts with either 'race' OR 'condition', not require both",
      "Add TestSearch_PartialWordMatch test function",
      "Test 'rac' finds 'race', 'cond' finds 'condition' (prefix matching)",
      "Verify: go test ./internal/api/handlers -run TestSearch_ExactTitleMatch -v passes",
      "Verify: go test ./internal/api/handlers -run TestSearch_MultiWordQuery -v passes",
      "Verify: go test ./internal/api/handlers -run TestSearch_PartialWordMatch -v passes"
    ],
    "passes": false
  },
  {
    "category": "backend",
    "description": "Fix search query logic - change AND to OR for better matching",
    "steps": [
      "Open backend/internal/db/search.go",
      "Find buildTsQuery function (around line 118-154)",
      "Current logic: word1:* & word2:* (strict AND - requires both words)",
      "Change to: word1:* | word2:* (relaxed OR - matches either word)",
      "Update string join from ' & ' to ' | '",
      "Keep prefix matching format: word:* for each term",
      "Add comment explaining OR logic improves UX - finds more results",
      "Verify: go test ./internal/db -run TestSearch -v passes",
      "Verify: go test ./internal/api/handlers -run TestSearch -v passes",
      "Verify: all search integration tests pass with OR logic"
    ],
    "passes": false
  },
  {
    "category": "backend",
    "description": "Add full-text search indexes to posts table if missing",
    "steps": [
      "Create backend/migrations/000034_add_fulltext_indexes.up.sql",
      "Add: CREATE INDEX IF NOT EXISTS idx_posts_title_tsvector ON posts USING GIN (to_tsvector('english', title));",
      "Add: CREATE INDEX IF NOT EXISTS idx_posts_description_tsvector ON posts USING GIN (to_tsvector('english', description));",
      "Add: CREATE INDEX IF NOT EXISTS idx_posts_content_tsvector ON posts USING GIN (to_tsvector('english', title || ' ' || description));",
      "Add comment explaining indexes accelerate full-text search queries",
      "Create backend/migrations/000034_add_fulltext_indexes.down.sql",
      "Add: DROP INDEX IF EXISTS idx_posts_title_tsvector;",
      "Add: DROP INDEX IF EXISTS idx_posts_description_tsvector;",
      "Add: DROP INDEX IF EXISTS idx_posts_content_tsvector;",
      "Test migration: migrate -path migrations -database $DATABASE_URL up",
      "Verify: SELECT indexname FROM pg_indexes WHERE tablename='posts' shows 3 new tsvector indexes",
      "Verify: Search queries run faster (<50ms) with indexes"
    ],
    "passes": false
  },
  {
    "category": "frontend",
    "description": "Create useDebounce hook for input debouncing",
    "steps": [
      "Create frontend/hooks/use-debounce.ts",
      "Import useState and useEffect from 'react'",
      "Export function useDebounce<T>(value: T, delay: number): T",
      "Create state: const [debouncedValue, setDebouncedValue] = useState<T>(value);",
      "useEffect with dependencies [value, delay]",
      "Inside effect: const handler = setTimeout(() => setDebouncedValue(value), delay);",
      "Return cleanup: return () => clearTimeout(handler);",
      "Return debouncedValue",
      "Add JSDoc comments explaining hook usage and parameters",
      "Verify: npx tsc --noEmit passes with no type errors"
    ],
    "passes": false
  },
  {
    "category": "frontend",
    "description": "Fix problems-filters.tsx - add input-level debouncing to stop API spam",
    "steps": [
      "Open frontend/components/problems/problems-filters.tsx",
      "Import: import { useState, useEffect } from 'react';",
      "Import: import { useDebounce } from '@/hooks/use-debounce';",
      "Add local state inside ProblemsFilters component: const [localQuery, setLocalQuery] = useState(filters.query || '');",
      "Add: const debouncedQuery = useDebounce(localQuery, 500); // 500ms debounce",
      "Add useEffect: when debouncedQuery changes, call onFiltersChange({ ...filters, query: debouncedQuery })",
      "Dependencies: [debouncedQuery]",
      "Change input onChange to: onChange={(e) => setLocalQuery(e.target.value)}",
      "Change input value to: value={localQuery}",
      "Now input updates local state immediately (no lag), parent updates after 500ms debounce",
      "Verify: typing 'race condition' (14 chars) triggers only 1 onFiltersChange call after 500ms, not 14"
    ],
    "passes": false
  },
  {
    "category": "frontend",
    "description": "Fix questions-filters.tsx - add input-level debouncing",
    "steps": [
      "Open frontend/components/questions/questions-filters.tsx",
      "Apply same fix as problems-filters.tsx",
      "Import useState, useEffect from 'react'",
      "Import useDebounce from '@/hooks/use-debounce'",
      "Add localQuery state and debouncedQuery with 500ms delay",
      "Add useEffect to update parent on debounced change",
      "Update input onChange to setLocalQuery, value to localQuery",
      "Verify: debouncing works for questions search"
    ],
    "passes": false
  },
  {
    "category": "frontend",
    "description": "Fix ideas-filters.tsx - add input-level debouncing",
    "steps": [
      "Open frontend/components/ideas/ideas-filters.tsx",
      "Apply same fix as problems-filters.tsx",
      "Import useState, useEffect from 'react'",
      "Import useDebounce from '@/hooks/use-debounce'",
      "Add localQuery state and debouncedQuery with 500ms delay",
      "Add useEffect to update parent on debounced change",
      "Update input onChange to setLocalQuery, value to localQuery",
      "Verify: debouncing works for ideas search"
    ],
    "passes": false
  },
  {
    "category": "frontend",
    "description": "Add TDD tests for search debouncing in problems-filters",
    "steps": [
      "Create frontend/components/problems/__tests__/problems-filters.test.tsx",
      "Import: render, screen, fireEvent, waitFor from '@testing-library/react'",
      "Import: vi from 'vitest'",
      "Import: ProblemsFilters from '../problems-filters'",
      "Test: 'debounces search input' - verify onFiltersChange called once after 500ms, not 14 times",
      "Mock onFiltersChange: const onFiltersChange = vi.fn();",
      "Render ProblemsFilters with empty filters",
      "Get input: screen.getByPlaceholderText('Search problems...')",
      "Type multiple characters quickly with fireEvent.change",
      "Assert onFiltersChange NOT called immediately: expect(onFiltersChange).not.toHaveBeenCalled();",
      "Wait 600ms: await waitFor(() => expect(onFiltersChange).toHaveBeenCalledTimes(1), { timeout: 600 });",
      "Test: 'updates input immediately for good UX' - verify no input lag",
      "Type in input, assert input.value updates immediately",
      "Verify: npm test -- problems-filters.test.tsx passes"
    ],
    "passes": false
  },
  {
    "category": "frontend",
    "description": "Add TDD tests for search results display in problems-list",
    "steps": [
      "Create frontend/components/problems/__tests__/problems-list.test.tsx",
      "Import: render, screen from '@testing-library/react'",
      "Import: vi from 'vitest'",
      "Import: ProblemsList from '../problems-list'",
      "Mock useSearch hook to return test data",
      "Test: 'displays search results' - mock 2 results, verify both titles appear",
      "Mock results: [{ id: '1', title: 'Race Conditions in Go' }, { id: '2', title: 'How to Handle Race Conditions' }]",
      "Render ProblemsList with searchQuery='race condition'",
      "Assert: screen.getByText('Race Conditions in Go') exists",
      "Assert: screen.getByText('How to Handle Race Conditions') exists",
      "Test: 'shows no results message when search returns empty'",
      "Mock useSearch to return empty array []",
      "Assert: screen.getByText(/no results found/i) exists",
      "Verify: npm test -- problems-list.test.tsx passes"
    ],
    "passes": false
  }
]
