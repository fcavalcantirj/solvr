{
  "version": "1.0",
  "title": "API Documentation Complete Fix & Sync",
  "description": "Complete overhaul of API documentation system with automated sync, Swagger UI integration, and comprehensive testing",
  "created": "2026-02-17",
  "status": "ready_to_implement",
  "tasks": [
    {
      "id": "api-docs-001",
      "number": 1,
      "phase": "Phase 1: Audit & Foundation",
      "category": "backend-testing",
      "title": "Create OpenAPI completeness validation tests",
      "description": "Write tests that verify every route in router.go has corresponding OpenAPI definition. Test should parse router.go and extract all route registrations (106 routes), parse openapi_paths.go buildPaths() (currently 56 paths covering 74 method+path combinations), and fail if any router route is missing from OpenAPI paths (32 missing). Should generate detailed diff report showing missing routes by category: Health & Infrastructure (11), Authentication (2), Agent Management (4), User Management (5), Stats & SEO (8), Other (2).",
      "acceptance_criteria": [
        "Test parses router.go and extracts all 106 r.Get/Post/Patch/Delete calls",
        "Test parses openapi_paths.go buildPaths() return value (56 paths)",
        "Test fails if any router route missing from OpenAPI paths (32 missing)",
        "Test fails if any OpenAPI path missing from router (deprecated)",
        "Test generates detailed diff report showing missing routes by category",
        "Test verifies all paths have: operationId, summary, tags, responses",
        "Test verifies all request bodies have schema $ref",
        "Test verifies all 200 responses have example or schema"
      ],
      "files_to_create": [
        "backend/internal/api/openapi_validation_test.go"
      ],
      "test_command": "cd backend && go test ./internal/api -run TestOpenAPICompleteness -v",
      "expected_failures_before_fix": [
        "32 routes in router.go but not in OpenAPI",
        "Multiple endpoints lack example responses"
      ],
      "passes": false,
      "dependencies": []
    },
    {
      "id": "api-docs-002",
      "number": 2,
      "phase": "Phase 1: Audit & Foundation",
      "category": "frontend-testing",
      "title": "Create frontend-backend sync validation tests",
      "description": "Write tests that fetch OpenAPI spec from https://api.solvr.dev/v1/openapi.json (56 paths) and compare with frontend endpoint data files (88 endpoints across core/content/user files). Should compare every OpenAPI path+method exists in frontend, verify auth fields match security requirements, and generate diff report of 32 endpoint discrepancies (missing, extra, mismatched).",
      "acceptance_criteria": [
        "Test fetches https://api.solvr.dev/v1/openapi.json",
        "Test parses api-endpoint-data-*.ts files (88 endpoints)",
        "Test compares: every OpenAPI path+method exists in frontend",
        "Test compares: every frontend endpoint exists in OpenAPI",
        "Test verifies auth field matches OpenAPI security requirements",
        "Test verifies HTTP method matches",
        "Test generates diff report: missing, extra, mismatched",
        "Test fails with detailed list of 32 discrepancies"
      ],
      "files_to_create": [
        "frontend/components/api/__tests__/api-sync-validation.test.ts"
      ],
      "test_command": "cd frontend && npm test api-sync-validation",
      "expected_failures_before_fix": [
        "32 endpoint discrepancies between frontend and OpenAPI",
        "Missing endpoints: /leaderboard, /sitemap/counts, /mcp, others",
        "Mismatched auth requirements on several endpoints"
      ],
      "passes": false,
      "dependencies": []
    },
    {
      "id": "api-docs-003",
      "number": 3,
      "phase": "Phase 1: Audit & Foundation",
      "category": "frontend-testing",
      "title": "Create broken link detection tests",
      "description": "Write tests that extract and validate all links from endpoint descriptions and responses",
      "acceptance_criteria": [
        "Test parses all endpoint descriptions and response examples",
        "Test extracts URLs matching pattern: /problems/*, /agents/*, https://*",
        "Test validates internal links: /problems/{id} format is valid",
        "Test validates external links: https://github.com/*, https://docs.*",
        "Test validates anchor links: #section-name exists on page",
        "Test generates report: broken link, location, suggested fix",
        "Test has --skip-external flag for CI (external links checked manually)"
      ],
      "files_to_create": [
        "frontend/components/api/__tests__/link-validation.test.ts"
      ],
      "test_command": "cd frontend && npm test link-validation",
      "expected_failures_before_fix": [
        "3-5 broken internal links to deprecated endpoints",
        "2-3 anchor links pointing to removed sections"
      ],
      "passes": false,
      "dependencies": []
    },
    {
      "id": "api-docs-004",
      "number": 4,
      "phase": "Phase 2: Backend OpenAPI Completion",
      "category": "backend-documentation",
      "title": "Add 32 missing OpenAPI path definitions",
      "description": "For each of 32 missing routes identified by Task 1, create OpenAPI path definition in openapi_paths.go. Categories: Health & Infrastructure (11): health endpoints, admin, discovery; Authentication (2): register, login; Agent Management (4): claim, list, activity, update; User Management (5): list users, user agents/contributions, me endpoints; Stats & SEO (8): stats, sitemap, leaderboard, export; Other (2): MCP, auth-methods. Follow existing pattern: operationId, summary, tags, parameters, responses. Use camelCase for operationId. Include all path/query params with schema. Add 200/401/404 responses as appropriate. Call new functions in buildPaths() in discovery.go. Verify Task 1 test passes (0 missing routes).",
      "acceptance_criteria": [
        "Run Task 1 test to get list of 32 missing routes",
        "For each missing route, add function in openapi_paths.go",
        "Follow existing pattern: operationId, summary, tags, parameters, responses",
        "Use camelCase for operationId (e.g., getUserProfile)",
        "Include all path params with schema, description, required",
        "Include all query params with schema, description, required, default",
        "Add 200 response with $ref to schema in components",
        "Add 401 response if auth required",
        "Add 404 response if {id} param exists",
        "Call new function in buildPaths() in discovery.go",
        "Verify: Task 1 test now passes (0 missing routes)"
      ],
      "files_to_modify": [
        "backend/internal/api/openapi_paths.go",
        "backend/internal/api/discovery.go"
      ],
      "test_command": "cd backend && go test ./internal/api -run TestOpenAPICompleteness -v",
      "verification_steps": [
        "Task 1 test passes (0 missing routes)",
        "curl https://api.solvr.dev/v1/openapi.json | jq '.paths | length' shows 88+ paths",
        "Every router route has OpenAPI definition"
      ],
      "passes": false,
      "dependencies": [1]
    },
    {
      "id": "api-docs-005",
      "number": 5,
      "phase": "Phase 2: Backend OpenAPI Completion",
      "category": "backend-documentation",
      "title": "Add response examples to all schemas",
      "description": "Enhance schemas with realistic example data for Swagger UI and docs",
      "acceptance_criteria": [
        "Open openapi_schemas.go buildSchemas() function",
        "For each schema, add 'example' field with realistic data",
        "Use actual production data patterns (anonymized)",
        "Example for Post: {id: 'p_abc123', type: 'problem', title: '...', ...}",
        "Example for SearchResponse: {data: [...], meta: {total: 42, ...}}",
        "Example for error responses: {error: 'Not found', code: 404}",
        "Cover all major schemas: Post, Agent, User, Answer, Approach, etc.",
        "Write test: TestOpenAPISchemaExamples",
        "Test verifies: all object schemas have example field",
        "Verify: Swagger UI shows examples when loaded"
      ],
      "files_to_modify": [
        "backend/internal/api/openapi_schemas.go"
      ],
      "files_to_create": [
        "backend/internal/api/openapi_schemas_test.go"
      ],
      "test_command": "cd backend && go test ./internal/api -run TestOpenAPISchemaExamples -v",
      "verification_steps": [
        "Test passes",
        "Swagger UI displays example payloads",
        "Example data is realistic and helpful"
      ],
      "passes": false,
      "dependencies": [4]
    },
    {
      "id": "api-docs-006",
      "number": 6,
      "phase": "Phase 3: Frontend Sync Automation",
      "category": "frontend-tooling",
      "title": "Build OpenAPI-to-frontend converter script",
      "description": "Create scripts/sync-api-docs.ts in frontend/ that fetches https://api.solvr.dev/v1/openapi.json and generates TypeScript endpoint data files. Script must output EndpointGroup[] format matching api-endpoint-types.ts interface (method: GET|POST|PATCH|DELETE, path: string, description: string, auth: jwt|api_key|both|none, params: Param[], response: string). Group by OpenAPI tags. Map OpenAPI security to auth field. Generate api-endpoint-data-core.ts, api-endpoint-data-content.ts, api-endpoint-data-user.ts with header: // AUTO-GENERATED - DO NOT EDIT. Include --dry-run flag, create .backup files. Add npm script: 'sync-api-docs': 'ts-node scripts/sync-api-docs.ts'",
      "acceptance_criteria": [
        "Create scripts/sync-api-docs.ts in frontend/",
        "Script fetches https://api.solvr.dev/v1/openapi.json",
        "Script parses paths object into EndpointGroup[] format",
        "Script groups endpoints by OpenAPI tags",
        "Core groups: Authentication, Agents, Search, Feed, Stats, MCP, Sitemap",
        "Content groups: Posts, Problems, Questions, Ideas",
        "User groups: Comments, User, API Keys, Bookmarks, Views, Reports",
        "Script generates api-endpoint-data-core.ts with header: // AUTO-GENERATED - DO NOT EDIT",
        "Script generates api-endpoint-data-content.ts",
        "Script generates api-endpoint-data-user.ts",
        "Script maps: OpenAPI summary -> description, security -> auth, parameters -> params",
        "Script includes --dry-run flag to preview changes",
        "Script creates backup: *.ts.backup before overwriting",
        "Add npm script: 'sync-api-docs': 'ts-node scripts/sync-api-docs.ts'"
      ],
      "files_to_create": [
        "frontend/scripts/sync-api-docs.ts"
      ],
      "files_to_modify": [
        "frontend/package.json"
      ],
      "test_command": "cd frontend && npm run sync-api-docs -- --dry-run",
      "verification_steps": [
        "Script runs without errors",
        "Generated TypeScript compiles: npx tsc --noEmit",
        "Diff shows correct sync: files match OpenAPI"
      ],
      "passes": false,
      "dependencies": [5]
    },
    {
      "id": "api-docs-007",
      "number": 7,
      "phase": "Phase 3: Frontend Sync Automation",
      "category": "frontend-sync",
      "title": "Execute frontend sync with backend OpenAPI",
      "description": "Run npm run sync-api-docs to update frontend docs (currently 88 endpoints) to match backend OpenAPI (56 paths after Task 4 completes = 103 total). Review git diff - verify removed endpoints were deprecated, verify added endpoints exist in router.go, verify auth requirements match OpenAPI security. If valuable descriptions lost, enhance OpenAPI summaries in backend first, re-run sync. Run Task 2 test: TestFrontendBackendSync must pass (0 of 32 discrepancies remaining). Commit synced files.",
      "acceptance_criteria": [
        "Run: npm run sync-api-docs",
        "Review git diff of changed files",
        "Verify removed endpoints: were they deprecated? Check router.go",
        "Verify added endpoints: confirm they exist in router.go",
        "Verify changed auth: confirm security requirements match OpenAPI",
        "If any valuable descriptions lost, enhance OpenAPI summaries in backend first",
        "Re-run sync after backend improvements",
        "Run Task 2 test: TestFrontendBackendSync",
        "Test must now pass (0 discrepancies)",
        "Commit synced files"
      ],
      "files_to_modify": [
        "frontend/components/api/api-endpoint-data-core.ts",
        "frontend/components/api/api-endpoint-data-content.ts",
        "frontend/components/api/api-endpoint-data-user.ts"
      ],
      "test_command": "cd frontend && npm test api-sync-validation",
      "verification_steps": [
        "Task 2 test passes",
        "npm run dev starts without errors",
        "Visit http://localhost:3000/api-docs - all sections render",
        "No duplicate endpoints visible",
        "Endpoint counts match OpenAPI spec"
      ],
      "passes": false,
      "dependencies": [6]
    },
    {
      "id": "api-docs-008",
      "number": 8,
      "phase": "Phase 4: Swagger UI Integration",
      "category": "frontend-feature",
      "title": "Add Swagger UI to API docs page",
      "description": "Integrate Swagger UI for interactive API exploration at /api-docs (current page location, will update SPEC.md from /docs/api). Install: npm install swagger-ui-react @types/swagger-ui-react. Create tabbed interface in app/api-docs/page.tsx. Tab 1: 'Documentation' (existing ApiEndpoints component). Tab 2: 'Interactive Explorer' (new SwaggerUI component). Configure SwaggerUI: url='https://api.solvr.dev/v1/openapi.json', docExpansion='list', displayRequestDuration=true. Add JWT auth input field - when user enters token, set Authorization header for try-it-out. Style with Solvr theme in globals.css. Preserve URL hash: /api-docs#interactive opens tab 2. Handle loading/error states. Add link from ApiHero: 'Try our interactive API explorer →'",
      "acceptance_criteria": [
        "Install: npm install swagger-ui-react @types/swagger-ui-react",
        "Create tabbed interface in app/api-docs/page.tsx",
        "Tab 1: 'Documentation' (existing custom view)",
        "Tab 2: 'Interactive Explorer' (new Swagger UI)",
        "Import SwaggerUI from 'swagger-ui-react'",
        "Configure: url='https://api.solvr.dev/v1/openapi.json'",
        "Set docExpansion='list', displayRequestDuration=true",
        "Style with Solvr theme: override .swagger-ui CSS in globals.css",
        "Add JWT auth input: When user enters token, set Authorization header",
        "Preserve URL hash: /api-docs#interactive opens tab 2",
        "Add link from ApiHero: 'Try our interactive API explorer →'",
        "Handle loading state while spec fetches",
        "Handle error state if spec fails to load"
      ],
      "files_to_modify": [
        "frontend/app/api-docs/page.tsx",
        "frontend/app/globals.css",
        "frontend/package.json"
      ],
      "test_command": "cd frontend && npm run dev",
      "verification_steps": [
        "Visit http://localhost:3000/api-docs",
        "See two tabs: Documentation | Interactive Explorer",
        "Click Interactive Explorer tab",
        "Swagger UI loads and displays all endpoint groups",
        "Can expand/collapse groups and endpoints",
        "Can input JWT token",
        "Can try GET endpoint and see response"
      ],
      "passes": false,
      "dependencies": [7, 14]
    },
    {
      "id": "api-docs-009",
      "number": 9,
      "phase": "Phase 4: Swagger UI Integration",
      "category": "frontend-testing",
      "title": "Add E2E tests for API docs page",
      "description": "Create comprehensive E2E tests for API docs functionality using Playwright (configured in Task 14). Create e2e/api-docs.spec.ts with tests: 'API docs page loads', 'Endpoint groups expand/collapse', 'Endpoint details display', 'Copy button works', 'Interactive Explorer tab loads', 'Swagger UI renders all groups', 'Swagger UI expands endpoints', 'JWT token input works', 'Search filters endpoints', 'Mobile responsive layout'. All tests must pass on CI. Prerequisite: Task 14 must be completed first.",
      "acceptance_criteria": [
        "Create e2e/api-docs.spec.ts (Playwright)",
        "Test: 'API docs page loads' - visit /api-docs, verify rendered",
        "Test: 'Endpoint groups expand' - click group, verify endpoints show",
        "Test: 'Endpoint details show' - click endpoint, verify params/response",
        "Test: 'Copy button works' - click copy, verify clipboard",
        "Test: 'Try it button opens playground' - click, verify modal",
        "Test: 'Swagger UI tab works' - click tab, verify Swagger UI loads",
        "Test: 'Swagger UI expands endpoint' - expand in Swagger, verify details",
        "Test: 'Search filters endpoints' - type search term, verify filtered",
        "Test: 'Mobile responsive' - resize viewport, verify layout adapts",
        "All tests must pass on CI"
      ],
      "files_to_create": [
        "frontend/e2e/api-docs.spec.ts"
      ],
      "test_command": "cd frontend && npm run test:e2e -- api-docs.spec.ts",
      "verification_steps": [
        "All E2E tests pass locally",
        "All E2E tests pass in CI",
        "Tests catch regressions when page modified"
      ],
      "passes": false,
      "dependencies": [8, 14]
    },
    {
      "id": "api-docs-010",
      "number": 10,
      "phase": "Phase 5: CI/CD Automation",
      "category": "devops-ci",
      "title": "Add CI workflow for API docs validation",
      "description": "Create GitHub Actions workflow to validate API docs on every PR",
      "acceptance_criteria": [
        "Create .github/workflows/api-docs-validation.yml",
        "Trigger: on pull_request for paths: internal/api/**, components/api/**",
        "Job 1: Backend OpenAPI validation",
        "- Run: go test ./internal/api -run TestOpenAPICompleteness",
        "- Fail PR if any router route missing from OpenAPI",
        "Job 2: Frontend sync validation",
        "- Run: npm test api-sync-validation",
        "- Fail PR if frontend doesn't match backend",
        "Job 3: Link validation",
        "- Run: npm test link-validation -- --skip-external",
        "- Fail PR if broken internal links found",
        "Job 4: Dry-run sync check",
        "- Run: npm run sync-api-docs -- --dry-run",
        "- Generate diff and post as PR comment",
        "- Warn (don't fail) if sync would change files",
        "Add PR comment bot: ✓ API docs validated or ✗ Issues found + details",
        "Add status check requirement in repo settings"
      ],
      "files_to_create": [
        ".github/workflows/api-docs-validation.yml"
      ],
      "test_command": "act pull_request -W .github/workflows/api-docs-validation.yml",
      "verification_steps": [
        "Workflow runs on PR",
        "Fails when docs out of sync",
        "Passes when docs in sync",
        "Bot comments on PR with validation status"
      ],
      "passes": false,
      "dependencies": [9]
    },
    {
      "id": "api-docs-011",
      "number": 11,
      "phase": "Phase 5: CI/CD Automation",
      "category": "devops-ci",
      "title": "Add auto-sync on main branch",
      "description": "Auto-commit frontend sync when backend changes merged to main",
      "acceptance_criteria": [
        "Create .github/workflows/api-docs-auto-sync.yml",
        "Trigger: on push to main, paths: internal/api/**",
        "Step 1: Checkout code",
        "Step 2: cd frontend && npm install",
        "Step 3: npm run sync-api-docs",
        "Step 4: git diff --exit-code (check if changes)",
        "Step 5: If changes: git add, commit, push",
        "Commit message: 'chore(api-docs): auto-sync frontend with backend OpenAPI [skip ci]'",
        "Use GitHub App token for push (not GITHUB_TOKEN)",
        "Add [skip ci] to prevent recursive triggers",
        "Notify #dev-alerts Slack channel when auto-sync runs"
      ],
      "files_to_create": [
        ".github/workflows/api-docs-auto-sync.yml"
      ],
      "test_command": "Simulate: Make backend change, merge PR, verify auto-commit",
      "verification_steps": [
        "Backend change merged to main",
        "Auto-sync workflow triggers",
        "Frontend files updated automatically",
        "New commit appears on main",
        "Slack notification received"
      ],
      "passes": false,
      "dependencies": [10]
    },
    {
      "id": "api-docs-012",
      "number": 12,
      "phase": "Phase 6: Documentation & Maintenance",
      "category": "documentation",
      "title": "Update SPEC.md with API docs workflow",
      "description": "Document complete API documentation maintenance workflow. Add SPEC.md Part 19.4.1: API Documentation Workflow. Explain single source of truth: openapi_paths.go + openapi_schemas.go. Document workflow: 1) Add route to router.go (103 total), 2) Add OpenAPI definition, 3) CI validates, 4) Auto-sync to frontend. Update line 2954: change 'Swagger UI at /docs/api' to 'Swagger UI at /api-docs' (matches actual implementation). List tools: sync-api-docs.ts, validation tests. Document CI checks: validation on PR, auto-sync on main. Add troubleshooting: 'Frontend out of sync' → run npm run sync-api-docs. Add examples: how to add new endpoint, how to update existing. Add diagram: Router → OpenAPI → CI → Frontend → Swagger UI. Update README.md: add API Documentation section linking to SPEC.md.",
      "acceptance_criteria": [
        "Add SPEC.md Part 19.4.1: API Documentation Workflow",
        "Explain single source of truth: openapi_paths.go + openapi_schemas.go",
        "Document workflow: 1) Add route to router.go, 2) Add OpenAPI definition, 3) CI validates, 4) Auto-sync to frontend",
        "List tools: sync-api-docs.ts, validation tests",
        "Document CI checks: validation on PR, auto-sync on main",
        "Explain Swagger UI: /api-docs Interactive Explorer tab",
        "Add troubleshooting section: 'Frontend out of sync' -> run npm run sync-api-docs",
        "Add examples: How to add new endpoint, how to update existing",
        "Add diagram: Router → OpenAPI → CI Validation → Frontend Sync → Swagger UI",
        "Update SPEC.md line 2954: '/docs/api' to '/api-docs'",
        "Update README.md: Add 'API Documentation' section with link to SPEC.md",
        "Add pre-commit hook suggestion: Run sync before commit if route changed"
      ],
      "files_to_modify": [
        "SPEC.md",
        "README.md"
      ],
      "verification_steps": [
        "Documentation is clear and complete",
        "New developer can follow workflow",
        "All tools and scripts documented",
        "Troubleshooting covers common issues"
      ],
      "passes": false,
      "dependencies": [11]
    },
    {
      "id": "api-docs-013",
      "number": 13,
      "phase": "Phase 6: Documentation & Maintenance",
      "category": "frontend-bugfix",
      "title": "Fix identified broken links",
      "description": "Update endpoint descriptions and examples to remove broken links",
      "acceptance_criteria": [
        "Run Task 3 test to get list of broken links",
        "For each broken link: determine if endpoint deprecated or URL wrong",
        "Update endpoint descriptions in synced data files",
        "If link to deprecated endpoint: remove or update to current endpoint",
        "If external link broken: update to correct URL or remove",
        "If anchor link broken: fix anchor or remove link",
        "Re-sync from backend if descriptions need updating there",
        "Run Task 3 test again",
        "Test must pass (0 broken links)",
        "Verify manually: Click through key links on /api-docs page"
      ],
      "files_to_modify": [
        "backend/internal/api/openapi_paths.go",
        "frontend/components/api/api-endpoint-data-*.ts"
      ],
      "test_command": "cd frontend && npm test link-validation",
      "verification_steps": [
        "Link validation test passes",
        "Manual spot-check: 10 random links work",
        "No 404 errors when clicking doc links"
      ],
      "passes": false,
      "dependencies": [7]
    },
    {
      "id": "api-docs-014",
      "number": 14,
      "phase": "Phase 4: Swagger UI Integration",
      "category": "frontend-testing-setup",
      "title": "Setup Playwright E2E testing infrastructure",
      "description": "Configure Playwright for E2E tests before writing API docs tests. Create playwright.config.ts with baseURL (http://localhost:3000), testDir (./e2e), timeout (30000), retries, reporter. Create e2e/ directory. Add test:e2e script to package.json. Create e2e/example.spec.ts smoke test (visit homepage, check title). Verify setup: npm run test:e2e passes locally. This is prerequisite for Task 9.",
      "acceptance_criteria": [
        "Create playwright.config.ts",
        "Set baseURL: http://localhost:3000",
        "Set testDir: ./e2e",
        "Set timeout: 30000ms",
        "Configure retries and reporters",
        "Create e2e/ directory",
        "Add 'test:e2e' script to package.json: 'playwright test'",
        "Create e2e/example.spec.ts smoke test",
        "Smoke test: visit homepage, check title exists",
        "Run: npm run test:e2e",
        "Verify: test passes locally",
        "Document in README: how to run E2E tests"
      ],
      "files_to_create": [
        "frontend/playwright.config.ts",
        "frontend/e2e/example.spec.ts"
      ],
      "files_to_modify": [
        "frontend/package.json"
      ],
      "test_command": "cd frontend && npm run test:e2e",
      "verification_steps": [
        "playwright.config.ts exists and is valid",
        "e2e/ directory exists",
        "Example test passes",
        "npm run test:e2e command works"
      ],
      "passes": false,
      "dependencies": [7]
    }
  ],
  "summary": {
    "total_tasks": 14,
    "phases": 6,
    "backend_tasks": 3,
    "frontend_tasks": 7,
    "testing_tasks": 4,
    "devops_tasks": 2,
    "documentation_tasks": 2,
    "estimated_story_points": 89,
    "critical_path": [1, 4, 5, 6, 7, 14, 8, 9, 10, 11, 12, 13]
  },
  "verified_counts": {
    "router_routes": 106,
    "openapi_paths": 56,
    "openapi_coverage": 74,
    "missing_routes": 32,
    "frontend_endpoints": 88,
    "frontend_gap": 32
  }
}
